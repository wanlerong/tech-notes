# 概述

操作系统是管理计算机硬件的程序，为应用程序提供基础，充当硬件和用户之间的中介。

计算机系统由，硬件、操作系统、系统程序和应用程序、用户组成

WX20240109-141640.png

计算机开启时，先运行bootstrap program（位于rom中，硬件中的固件），初始化系统，包括CPU寄存器，设备控制器，内存内容。定位操作系统内核并把它装入内存。然后开始执行第一个进程如 init，并等待事件的发生。

事件发生通过硬件或软件的中断（interrupt）来表示, 硬件通过系统总线向cpu发出信号触发interrupt, 软件通过系统调用等方式触发interrupt

操作系统是由 interrupt 驱动的。

### 存储结构：

内存（RAM random access memory）、磁盘

WX20240109-143702.png

电子磁盘以上是易失的内存，以下是不易失的磁盘
电子磁盘本身是易失或非易失的，有内存区域，许多还有隐藏的磁盘和备份电源，外部断电时会把数据从内存写到磁盘。

### IO结构
设备控制器（如显卡）：有一定量的缓冲存储，负责在外部设备与本地缓冲存储之间进行数据传递。
设备驱动程序（如显卡驱动）：负责理解设备控制器，并提供一个设备与操作系统的统一接口。

WX20240109-150321.png

设备控制器中断驱动，适合移动少量数据。
DMA 直接内存访问，可以在设备控制器的本地缓冲和内存之间传送一整块数据。

## cpu

多核cpu，最为普遍的是对称处理，每个处理器都要完成操作系统总的所有任务。
计算机系统的设计有多种不同的方法。单处理器系统只有一个处理器，而多处理器系统包含两个或更多的处理器来共享物理存储及外设。对称多处理技术（SMP）是最为普通的多处理器设计技术，其中所有的处理器被视为对等的，且彼此独立地运行。集群系统是一种特殊的多处理器系统，它由通过局域网连接的多个计算机系统组成。


为了最好地利用CPU，现代操作系统采用允许多个作业同时位于内存中的多道程序设计，以保证CPU中总有一个作业在执行。分时系统是多道程序系统的扩展，它采用调度算法实现作业之间快速的切换，好像每个作业在同时进行一样。

只要有一个任务可以执行，cpu就不会空闲。
分时操作系统，允许多个用户同时共享cpu时间。每个用户在内存中至少有一个进程，进程执行时，通常只执行较短的时间，此时它并未完成，或者需要等待IO操作，操作系统会将cpu切换到其他用户的进程。



操作系统必须确保计算机系统的正确操作。为了防止用户干预系统的正常操作，硬件有两种模式：用户模式和内核模式。许多指令（如I／O指令和停机指令）都是特权的，只能在内核模式下执行。操作系统所驻留的内存也必须加以保护以防止用户程序修改。定时器防止无穷循环。这些工具（如双模式、特权指令、内存保护、定时器中断）是操作系统所使用的基本单元，用以实现正确操作。


进程（或作业）是操作系统工作的基本单元。进程管理包括创建和删除进程、为进程提供与其他进程通信和同步的机制。操作系统通过跟踪内存的哪部分被使用及被谁使用来管理内存。操作系统还负责动态地分配和释放内存空间，同时还管理存储空间，包括为描述文件提供文件系统和目录，以及管理大存储器设备的空间。


操作系统必须考虑到它与用户的保护和安全问题。保护是提供控制进程或用户访问计算机系统资源的机制。安全措施用来抵御计算机系统所受到的外部或内部的攻击。


分布式系统允许用户共享通过网络连接的、在地理位置上是分散的计算机的资源。可以通过客户机—服务器模式或对等模式来提供服务。在集群系统中，多个机器可以完成驻留在共享存储器上的数据的计算，即便某些集群的子集出错，计算仍可以继续。
局域网和广域网是两种基本的网络类型。局域网允许分布在较小地理区域内的处理器进行通信，而广域网允许分布在较大地理区域内的处理器进行通信。局域网通常比广域网快。


# 操作系统结构

## 系统调用
进程控制，文件管理，设备管理，信息维护，通信。

进程控制
结束，放弃 
装入，执行 
创建进程，终止进程
取得进程属性，设置进程属性
等待时间 
等待事件，唤醒事件
分配和释放内存 

文件管理 。
创建文件，删除文件 
打开，关闭 
读、写、重定位
取得文件属性，设置文件属性

设备管理
请求设备，释放设备
读、写、重定位
取得设备属性，设置设备属性
逻辑连接或断开设备

信息维护 
读取时间或日期，设置时间或日期读取系统数据，设置系统数据
读取进程，文件或设备属性。
设置进程，文件或设备属性

通信
创建，删除通信连接 。
发送，接受消息 
传递状态消息
连接或断开远程设备


# 进程管理

进程可看做是正在执行的程序。进程需要一定的资源（如CPU时间、内存、文件和I/O设备）来完成其任务。这些资源在创建进程或执行进程时被分配。进程是大多数系统中的工作单元。

进程通常还包括进程堆栈段（包括临时数据，如函数参数、返回地址和局部变量）和数据段（包括全局变量）。进程还可能包括堆（heap），是在进程运行期间动态分配的内存。

进程是活动实体，它有一个程序计数器用来表示下一个要执行的命令和相关资源集合。（还包括处理器寄存器的内容）
当一个可执行文件被装入内存时，一个程序才能成为进程。

WX20240109-155856.png

进程状态

新的：进程正在被创建。
运行：指令正在被执行。
等待：进程等待某个事件的发生（如I／O完成或收到信号）。
就绪：进程等待分配处理器。
终止：进程完成执行。

WX20240109-160632.png


每个进程在操作系统内用进程控制块（process control block，PCB，也称为任务控制块）来表示。

WX20240109-161003.png


进程状态：状态可包括新的、就绪、运行、等待、停止等。
程序计数器：计数器表示进程要执行的下个指令的地址
CPU寄存器：根据计算机体系结构的不同，寄存器的数量和类型也不同。它们包括累加器、索引寄存器、堆栈指针、通用寄存器和其他条件码信息寄存器。与程序计数器一起，这些状态信息在出现中断时也需要保存，以便进程以后能正确地继续执行。
CPU调度信息：这类信息包括进程优先级、调度队列的指针和其他调度参数
内存管理信息：根据操作系统所使用的内存系统，这类信息包括基址和界限寄存器的值、页表或段表（见第8章）。
记账信息：这类信息包括CPU时间、实际使用时间、时间界限、记账数据、作业或进程数量等。
IO状态信息：这类信息包括分配给进程的IO设备列表、打开的文件列表等。简而言之，PCB简单地作为这些信息的仓库，这些信息在进程与进程之间是不同的。

CPU 在进程间切换
WX20240109-161630.png


## 进程调度

进程会被加到作业队列中，该队列包括系统中的所有进程。
驻留在内存中就绪的、等待运行的进程保存在就绪队列中。该队列通常用 PCB 的链表来实现。

linux 中的 PCB 实现：task_struct
pid_t pid                               process identifier
long state                              state of the process
unsigned int time_slice                 Scheduling information
struct files_struct \*files；        	list of open files
struct mm_struct \*mm              		address space of this process

WX20240109-170501.png


就绪队列和各种设备队列。进程可能需要等待磁盘，因为磁盘在忙于其他进程的IO请求

WX20240109-170625.png

WX20240109-171326.png

短期调度程序必须频繁地为 CPU 选择新进程。进程可能执行数毫秒（ms）就会进行IO请求，短期调度程序通常每100ms至少执行一次。由于每次执行之间的时间较短，短期调度程序必须要快。

### 上下文切换

上下文切换：CPU切换到另一个进程，需要保存当前进程的上下文，并恢复另一个进程的状态。

中断使CPU从当前任务改变为运行内核子程序，这样的操作在通用系统中发生得很频繁。当发生一个中断时，系统需要保存当前运行在CPU中进程的上下文，从而在其处理完后能恢复上下文，即先中断进程，之后再继续。进程上下文用进程的PCB表示，它包括 CPU寄存器的值、进程状态和内存管理信息等。



# 内存管理

# 存储管理

## IO

# 保护与安全

# 分布式系统

# 特殊用途系统

